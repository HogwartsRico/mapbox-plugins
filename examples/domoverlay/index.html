<!doctype html>
<head>
    <title>Dom Overlay Demo</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">   
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href='../../dist/mapbox-gl.css' rel='stylesheet' />    
    <link href="../../styles.css" rel="stylesheet" />
</head>

<div id='map' style='width: 800px; height: 600px; border: 1px dotted #aaa;'></div>
<!--<script src='../../dist/mapbox-gl.js'></script>-->
<script src='https://alex2wong.github.io/mapbox-plugins/dist/mapbox-gl.js'></script>
<script src='../../dist/bundle.js'></script>
<script>
    // import * as Alex from '../src/index';

    var data = null;
    mapboxgl.accessToken = false;
    var mapCenter = [118.0066, 30.6135];
    var map = new mapboxgl.Map({
        style: {
            "version": 8,
            "sprite": "https://alex2wong.github.io/mapbox-plugins/assets/sprite",
            "glyphs": "https://alex2wong.github.io/mapbox-plugins/{fontstack}/{range}.pbf",
            "sources": {
                "custom-tms": {   
                    'type': 'raster',
                    'tiles': [
                        "https://huangyixiu.co:3003/proxy?proxyURI=http://map.geoq.cn/ArcGIS/rest/services/ChinaOnlineStreetPurplishBlue/MapServer/tile/{z}/{y}/{x}",
                        // "http://www.google.cn/maps/vt?lyrs=s@702&gl=cn&x={x}&y={y}&z={z}",
                        // "https://stamen-tiles.a.ssl.fastly.net/toner/{z}/{x}/{y}.png"
                    ],
                    'tileSize': 256
                },
            },
            "layers": [
                {
                    'id': 'custom-tms',
                    'type': 'raster',
                    'source': 'custom-tms',
                    'paint': {}
                },
            ]
        },
        center: mapCenter,
        zoom: 6,
        pitch: 15,
        bearing: 0,
        light: {
            'anchor':'viewport',
            'color':'white',
            'intensity':0.7
        },
        container: 'map'
    });

    map.on('load', function() {
        Alex.Util.getJSON("../../assets/countries.geojson")
            .then((res) => {
                console.log("got jsonData..");
                data = res;
                map.addSource("world", {
                    "type": "geojson",
                    "data": data
                });
                map.addLayer({
                    "id": "world",
                    "source": "world",
                    "type": "fill",
                    "paint": {
                        "fill-color": "rgba(0,0,0,0.4)",
                        "fill-outline-color": "#eee",
                        "fill-opacity": 0.4
                    },
                    // "filter": ["==", "$type", "Polygon"]
                });
            });
        var domLayer = new Alex.DomOverlayer({
            map: map,
            doms: [
                {
                    icon: 'rocket-11',
                    content: "This is domOverlay",
                    lon: mapCenter[0],
                    lat: mapCenter[1]
                },
                // {
                //     icon: 'airfield-15',
                //     content: "-------------------",
                //     lon: mapCenter[0] + 1,
                //     lat: mapCenter[1] + 0.5
                // }
            ]
        });

        setInterval(()=>{
            map.setBearing(map.getBearing() + 0.1);
        }, 1000);
    });

</script>
